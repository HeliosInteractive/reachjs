/*Reach Client v2.0.3*/
!function(exports, global) {"use strict";function querystring(a){function b(b,c){return b.push(c+"="+encodeURIComponent(a[c])),b}return a?"string"==typeof a?"?"+a:"?"+Object.keys(a).reduce(b,[]).join("&"):""}function parseHeaders(a){function b(a){if(a){var b=a.split(":");c[b[0]]=b[1].trim()}}if(!a)return a;var c={};return a.split("\r\n").forEach(b),c}function getForm(a){var b=require("form-data"),c=new b;return c.append("file",a.data,{filename:a.path,contentType:a.type,basename:!1}),c}function formatData(a){if("POST"!==a.method&&"PUT"!==a.method)return a;if(a.headers&&"multipart/form-data"===a.headers["Content-Type"])return a;var b=exports.merge(!0,a);return delete b.headers,delete b.uri,delete b.data,delete b.method,a.data=b,a}function filter(a,b){b.where&&(a.where=b.where),b.limit&&(a.limit=b.limit),b.include&&(a.include=b.include),b.skip&&(a.skip=b.skip),b.fields&&(a.fields=b.fields),b.order&&(a.order=b.order);var c=!1;if(Object.keys(a).length>0)try{c=JSON.stringify(a)}catch(d){}return c}function verbFunc(a){return function(b,c,d){return"function"==typeof c&&(d=c,c={}),"object"==typeof b?b.method=a:c.method=a,reach(b,c,d)}}function upload(a,b,c){b[0]?b=b.map(function(b){return b.path=a+b.name,b}):b.path=a+b.name,"/"===a.substr(0,1)&&(a=a.substr(1)),reach("containers/reachdata/upload",{method:"POST",headers:{"Content-Type":"multipart/form-data"},data:b},c)}var xhr=function(a,b,c){function d(a){c(a)}function e(a){var b={body:a.target.response,status:a.target.status,url:a.target.responseURL,headers:parseHeaders(f.oReq.getAllResponseHeaders())};try{var d=JSON.parse(a.target.response);b.body=d}catch(e){}c(null,b)}var f=this;f.oReq=new XMLHttpRequest,a+=querystring(b.qs),f.oReq.addEventListener("load",e),f.oReq.addEventListener("error",d),f.oReq.open(b.method&&b.method.toUpperCase()||"GET",a,!0);var g=null;b.data&&(b.headers&&"multipart/form-data"===b.headers["Content-Type"]?(g=new FormData,g.append("file",b.data.data,b.data.path),delete b.headers["Content-Type"]):g=JSON.stringify(b.data)),b.headers&&"object"==typeof b.headers&&Object.keys(b.headers).forEach(f.setHeaders.bind(f,b.headers)),f.oReq.send(g)};xhr.prototype.setHeaders=function(a,b){this.oReq.setRequestHeader(b,a[b])};var http=function(a,b,c){function d(b){function d(a){f.body+=a}function e(){try{var a=JSON.parse(f.body);f.body=a}catch(b){}c(null,f)}var f={body:"",status:b.statusCode,url:a,headers:b.headers};b.setEncoding("utf8"),b.on("data",d),b.on("end",e)}function e(a){c(a)}var f=require("url");a+=querystring(b.qs);var g=f.parse(a,!0,!0),h=require("https:"===g.protocol?"https":"http"),i={host:g.hostname,protocol:g.protocol,port:g.port,path:g.path,headers:b.headers,method:b.method},j=!1;b.headers&&"multipart/form-data"===b.headers["Content-Type"]&&(j=getForm(b.data),i.headers["Content-Type"]=j.getHeaders()["content-type"]);var k=h.request(i,d).on("error",e);j?j.pipe(k):b.data&&k.write(JSON.stringify(b.data)),k.end()};"undefined"!=typeof module&&module.exports?exports.request=module.exports=http:exports.request=xhr;var request,image,_url,reach=function(a,b,c){if(!_url)throw new Error("set the url for reach with reachjs.setUrl('')");if("undefined"==typeof a)throw new Error("undefined is not a valid uri or options object.");if(!reach.key&&b.qs&&!b.qs.access_token)throw new Error("reach.key or token is required");"function"==typeof b&&(c=b),"object"==typeof b?b.uri=a:b="string"==typeof a?{uri:a}:a,"/"===b.uri.substr(0,1)&&(b.uri=b.uri.substr(1)),b=formatData(b),a=_url+b.uri,delete b.uri;var d=filter({},b);return b.qs||(b.qs={}),d&&(b.qs.filter=d),!b.headers&&(b.headers={}),reach.key&&(b.headers["X-Helios-ID"]=reach.key),b.headers["Content-Type"]||(b.headers["Content-Type"]="application/json"),new request(a,b,c)};"undefined"!=typeof module&&module.exports?module.exports=reach:global.reach=exports.reach=reach,request=exports&&exports.request?exports.request:require("./lib/request"),image=exports&&exports.image?exports.image:require("./lib/image"),exports&&exports.merge||(exports.merge=require("./lib/merge")),reach.key=null,reach.get=verbFunc("GET"),reach.post=verbFunc("POST"),reach.put=verbFunc("PUT"),reach.del=verbFunc("DELETE"),reach.request=request,reach.image=image,reach.upload=upload,reach.development=function(){console.error("reach.development is no longer supported. Set the url explicitly with reach.setUrl()")},reach.setUrl=function(a){"/"!==a.substr(-1)&&(a+="/"),"api/"!==a.substr(-4)&&(a+="api/"),a&&(_url=a)};}({}, function() {return this || window || {};}());