/*Reach Client v2.1.0*/
(function(factory) {
    
    // Establish the root object, window (self) in the browser, or global on the server.
    // We use self instead of window for WebWorker support.
    var root = (typeof self == 'object' && self.self === self && self) ||
        (typeof module == 'object' && module);

    // Set up reach appropriately for the environment. Start with AMD.
    if (typeof define === 'function' && define.amd) {
      define('reach', ['exports'], function(exports) {
        // Export global even in AMD case in case this script is loaded with
        // others that may still expect a global reach.
        root.reach = factory();
        // return reach for correct AMD use
        return root.reach;
      });

      // Next for Node.js or CommonJS.
    } else if (typeof exports !== 'undefined') {
        root.exports = factory();
      // Finally, as a browser global.
    } else {
      root.reach = factory();
    }

  })(function() {
  "use strict";function formatData(a){if("POST"!==a.method&&"PUT"!==a.method)return a;if(a.headers&&"multipart/form-data"===a.headers["Content-Type"])return a;var b=merge(!0,a);return delete b.headers,delete b.uri,delete b.data,delete b.method,a.data=b,a}function filter(a,b){b.where&&(a.where=b.where),b.limit&&(a.limit=b.limit),b.include&&(a.include=b.include),b.skip&&(a.skip=b.skip),b.fields&&(a.fields=b.fields),b.order&&(a.order=b.order);var c=!1;if(Object.keys(a).length>0)try{c=JSON.stringify(a),c="filter="+c}catch(d){}return c}function verbFunc(a){return function(b,c,d){return"function"==typeof c&&(d=c,c={}),"object"==typeof b?b.method=a:c.method=a,reach(b,c,d)}}function upload(a,b,c){b[0]?b=b.map(function(b){return b.path=a+b.name,b}):b.path=a+b.name,"/"===a.substr(0,1)&&(a=a.substr(1)),reach("containers/reachdata/upload",{method:"POST",headers:{"Content-Type":"multipart/form-data"},data:b},c)}var request=function(){function a(a){function b(b,c){return b.push(c+"="+encodeURIComponent(a[c])),b}return a?"string"==typeof a?"?"+a:"?"+Object.keys(a).reduce(b,[]).join("&"):""}function b(a){function b(a){if(a){var b=a.split(":");c[b[0]]=b[1].trim()}}if(!a)return a;var c={};return a.split("\r\n").forEach(b),c}function c(a){var b=require("form-data"),c=new b;return c.append("file",a.data,{filename:a.path,contentType:a.type,basename:!1}),c}var d=function(c,d,e){function f(a){e(a)}function g(a){var c={body:a.target.response,status:a.target.status,url:a.target.responseURL,headers:b(h.oReq.getAllResponseHeaders())};try{var d=JSON.parse(a.target.response);c.body=d}catch(f){}e(null,c)}var h=this;h.oReq=new XMLHttpRequest,c+=a(d.qs),h.oReq.addEventListener("load",g),h.oReq.addEventListener("error",f),h.oReq.open(d.method&&d.method.toUpperCase()||"GET",c,!0);var i=null;d.data&&(d.headers&&"multipart/form-data"===d.headers["Content-Type"]?(i=new FormData,i.append("file",d.data.data,d.data.path),delete d.headers["Content-Type"]):i=JSON.stringify(d.data)),d.headers&&"object"==typeof d.headers&&Object.keys(d.headers).forEach(h.setHeaders.bind(h,d.headers)),h.oReq.send(i)};d.prototype.setHeaders=function(a,b){this.oReq.setRequestHeader(b,a[b])};var e=function(b,d,e){function f(a){function c(a){f.body+=a}function d(){try{var a=JSON.parse(f.body);f.body=a}catch(b){}e(null,f)}var f={body:"",status:a.statusCode,url:b,headers:a.headers};a.setEncoding("utf8"),a.on("data",c),a.on("end",d)}function g(a){e(a)}var h=require("http"),i=require("url");b+=a(d.qs);var j=i.parse(b,!0,!0),k={host:j.hostname,protocol:j.protocol,port:j.port,path:j.path,headers:d.headers,method:d.method},l=!1;d.headers&&"multipart/form-data"===d.headers["Content-Type"]&&(l=c(d.data),k.headers["Content-Type"]=l.getHeaders()["content-type"]);var m=h.request(k,f).on("error",g);l?l.pipe(m):d.data&&m.write(JSON.stringify(d.data)),m.end()};return"undefined"!=typeof XMLHttpRequest?d:e}(),request,image,_url,reach=function(a,b,c){if(!_url)throw new Error("set the url for reach with reachjs.setUrl('')");if("undefined"==typeof a)throw new Error("undefined is not a valid uri or options object.");if(!reach.key)throw new Error("reach.key is required");"function"==typeof b&&(c=b),"object"==typeof b?b.uri=a:b="string"==typeof a?{uri:a}:a,"/"===b.uri.substr(0,1)&&(b.uri=b.uri.substr(1)),b=formatData(b),a=_url+b.uri,delete b.uri;var d=filter({},b);return d&&(b.qs=d),!b.headers&&(b.headers={}),b.headers["X-Helios-ID"]=reach.key,b.headers["Content-Type"]||(b.headers["Content-Type"]="application/json"),new request(a,b,c)};reach.key=null,reach.get=verbFunc("GET"),reach.post=verbFunc("POST"),reach.put=verbFunc("PUT"),reach.del=verbFunc("DELETE"),reach.request=request,reach.image=image,reach.upload=upload,reach.development=function(){console.error("reach.development is no longer supported. Set the url explicitly with reach.setUrl()")},reach.setUrl=function(a){"/"!==a.substr(-1)&&(a+="/"),"api/"!==a.substr(-4)&&(a+="api/"),a&&(_url=a)};
    return reach;
  });